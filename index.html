<!DOCTYPE html>
<html>
<head>
	<title>Thorana</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>
	<canvas style="background: rgba(0,0,0,0.9);width: 100%;height: 100%" id="myCanvas">
		Your browser not supported. please try with a different device.
	</canvas>
	<div class="container">
		<div class="row">
		</div>

		<div class="row" style="display: block;">
			<div class="col-sm-6">
				<img src="images/candvas.png" class="img-fluid img-thumbnail" alt="">
				<audio id="theAudio" src="images/ASEMATUWANA.MP3" controls></audio>
			</div>
			<div class="col" >
				<div id="description">
					Description සිංහල <br> with events</div>
				</div>
		</div>
	</div>
	<script>
		var description = document.getElementById('description');
		var audioElement = document.getElementById("theAudio");
		var currentTime;//audioElement.currentTime;
			audioElement.ontimeupdate = function(){
				currentTime = audioElement.currentTime;
				if (currentTime>5 ) {
					description.innerHTML = "sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>sample text සිංහල <br>";
				}else{
					description.innerHTML = "ආරම්භය";
				}
				// console.log();
			}
		// audioElement.play();
		// audioElement.setAttribute('style','display:none');

		var myCanvas;
		var canvasWidth,canvasHeight;
		var ww,hw;
		var w,h;
		var context;
		var r,R,z; //radius of circles and z = sin(pi/8)
		var marginTop,marginBotom;
		var cx = new Array();
		var cy = new Array();
		var pointSqx,pointSqy; // starting point of squre down
		var dimPointSqx,dimPointSqy; // end point of squre down
		var fractionOfDispSmall,fractionOfDispLarge //bulb display area as fraction of radius
		var angleBC; 	//angle between box and botom circle center (c0)
		var leftImgBoxStartX,leftImgBoxStartY,rightImgBoxStartX,rightImgBoxStartY; //starting coodinates of first image boxes
		var leftImageBoxW,leftImageBoxH,rightImgBoxW,rightImgBoxH; // dimensions of image boxes	
		var imageBoxPadding;
		var pointX,pointY;

		window.onload = function(){
			ww = window.innerWidth;
			hw = window.innerHeight;

			myCanvas = document.getElementById('myCanvas');
			myCanvas.width = ww;
			myCanvas.height = ww/2;
			 
			//full screen function
			function fullscreen(){
	           // var el = document.getElementById('canvas');
	           if(myCanvas.webkitRequestFullScreen) {
	               myCanvas.webkitRequestFullScreen();
	           }
	          else {
	             myCanvas.mozRequestFullScreen();
	          }            
			}
			myCanvas.addEventListener("click",fullscreen);

			w = myCanvas.width;
			h = myCanvas.height;

			//calculate r and R (radii) - *get canvas dimentions [leave margings from top and bottom and use rest for draw circles]
			marginTop = 0.04;  // 4% of w
			marginBotom = 0.1; // 10% of w
			z = Math.sin(Math.PI/8);
			r = ((1 - (marginTop + marginBotom)) / 4) * (z / (z + 1)) * w;
			R = ((1 - z) / z) * r;

			// calculate center possitions of each circles
			cx[0] = w/2;	// centers of main circle
			cy[0] = (h/2)*(1 + marginTop - marginBotom);

			for (var i = 0; i <= 7; i++) {
				// creating x coordinates of centers
				cx[i+1] = cx[0] + (R + r) * Math.sin(i*(Math.PI/4));
			}

			for (var i = 0; i <= 7; i++) {
				// creating y coordinates of centers
				cy[i+1] = cy[0] + (R + r) * Math.cos(i*(Math.PI/4));
			}

			// calculate dimentions of down square
			pointSqx = cx[0] - (R + 3*r);		// starting point
			pointSqy = (cy[0] + r) + ((R + r)/(Math.sqrt(2)));
			dimPointSqx = 6*r + 2*R;			// dimensions
			dimPointSqy = 0.98*h - pointSqy;

			// get context of the canvas
			context = myCanvas.getContext("2d");
			
			// draw square
			context.beginPath();
			context.strokeStyle = "rgba(255,255,255,1)";
			context.fillStyle = "rgba(0,0,0,0.4)";
			context.strokeRect(pointSqx,pointSqy,dimPointSqx,dimPointSqy);
			context.fillRect(pointSqx,pointSqy,dimPointSqx,dimPointSqy);
			context.fill();
			context.closePath();

			// create image boxess
			imageBoxPadding = 0.01*h;
			// create left image box
			var d = (r - cy[1] + cy[8])/r;
			angleBC = Math.acos(d);
			leftImgBoxStartX = pointSqx + imageBoxPadding;
			leftImgBoxStartY = pointSqy + imageBoxPadding;
			leftImageBoxH = dimPointSqy - 2*imageBoxPadding;
			leftImageBoxW = R +3*r - r*Math.sin(angleBC) - 2*imageBoxPadding;

			var imageBoxLeft = new Image();
			imageBoxLeft.src = "images/data5.jpg";
			imageBoxLeft.addEventListener('load',function(){
				context.drawImage(imageBoxLeft,leftImgBoxStartX,leftImgBoxStartY,leftImageBoxW,leftImageBoxH);		
			});

			// create right image box
			rightImgBoxStartX = cx[0] + r*Math.sin(angleBC) + imageBoxPadding;
			rightImgBoxStartY = cy[1] + r*Math.cos(angleBC) + imageBoxPadding;
			rightImgBoxH = leftImageBoxH ;//- 2*imageBoxPadding already added;
			rightImgBoxW = leftImageBoxW ;//- 2*imageBoxPadding already added;

			var imageBoxRight = new Image();
			imageBoxRight.src = "images/data5.jpg";
			imageBoxRight.addEventListener('load',function(){
				context.drawImage(imageBoxRight,rightImgBoxStartX,rightImgBoxStartY,rightImgBoxW,rightImgBoxH);		
			});


			for(var i = 0; i <= cx.length ; i++){
				//draw outer circle of each circles
				context.beginPath();
				context.strokeStyle = "rgba(255,255,255,1)";
				context.fillStyle = "rgba(0,0,0,1)";
				if (i == 0) {
					context.arc(cx[i],cy[i],R,Math.PI*2,false);
				}else{
					context.arc(cx[i],cy[i],r,Math.PI*2,false);
				}
				context.stroke();
				context.fill();
				context.closePath();
			}

			fractionOfDispSmall = 0.6 ;
			fractionOfDispLarge = 0.1 ;
			for(var i = 0; i <= cx.length ; i++){
				//draw inner circle of each circles
				context.beginPath();
				context.strokeStyle = "rgba(255,255,255,1)";
				context.fillStyle = "rgba(255,255,255,0.7)";
				if (i == 0) {
					context.arc(cx[i],cy[i], R * fractionOfDispLarge , Math.PI*2,false);
				}else{
					context.arc(cx[i],cy[i], r* fractionOfDispSmall , Math.PI*2,false);
				}
				context.stroke();
				context.fill();
				context.closePath();
			}
			
			// Center circle inner Bulb animations set

			var flowerCenter = 0.88*R*(1 - fractionOfDispLarge);
			var flowerCenterDotSize = 0.004*w;
			var flowerOuterDotSize = 0.0038*w;
			var flowerLevel1FormCenter = 0.012 *w;
			var countOuterFlowers = 5;
			// var flowerLevel2FormCenter = flowerLevel1FormCenter *2;

			var centerCircleFlowerPattern = function(){
				for (var i1 = 0 ;i1 <8 ;i1++){
					if (i1 == 2) {
						continue;
					}else{
						var flowerCenterAngle = Math.PI/4*i1; // 2*PI/8 = PI/4
						var flowerX = cx[0] + flowerCenter * Math.cos(flowerCenterAngle);
						var flowerY = cy[0] + flowerCenter * Math.sin(flowerCenterAngle); 
						context.beginPath();
						context.fillStyle = "rgba(255,255,255,"+Math.random()+")";
						// context.clearRect(flowerX-flowerCenterDotSize,flowerY-flowerCenterDotSize,2*flowerOuterDotSize,flowerOuterDotSize*2);
						context.arc(flowerX ,flowerY, flowerCenterDotSize  , Math.PI*2,false);
						context.fill();
						context.closePath();

						// flower level 1
						
						var red = 255*Math.random();
						var intense = Math.random();

						for(var i2 = 0 ; i2 < countOuterFlowers ;i2++){
							var flowerOuterDotAngle = flowerCenterAngle + 2*Math.PI/countOuterFlowers*i2;

							var level2posX = flowerX + flowerLevel1FormCenter * Math.cos(flowerOuterDotAngle);
							var level2posY = flowerY + flowerLevel1FormCenter * Math.sin(flowerOuterDotAngle);
							
							context.beginPath();
							// context.fillStyle = "rgba(0,0,0,1)";
							// context.clearRect(level2posX - flowerOuterDotSize,level2posY - flowerOuterDotSize,flowerOuterDotSize,flowerOuterDotSize);
							context.fillStyle = "rgba("+red+",10,0,"+intense+")";
							context.arc(level2posX,level2posY, flowerOuterDotSize  , Math.PI*2,false);
							context.fill();
							context.closePath();
						}
					}
				}
				// requestAnimationFrame(centerCircleFlowerPattern);
			}
			
			// center circle filler patern
			var numberOfDotsEach = {
				// line:[6,12,18,12,30,]
				line: [12,18,30,30,48]
			}
			var centerCircleFillerPattern = function(){
				for(var i4 = 0;i4<5 ;i4++){
					var intensity2 = Math.random();
					for(var i3 = 0;i3<numberOfDotsEach.line[i4] ;i3++){
						var plotAngle = 2*Math.PI/numberOfDotsEach.line[i4]*i3;
						if (plotAngle > Math.PI/4 && plotAngle < Math.PI/4*3) {
							continue;
						}else{
							var localR =  (2+i4)*fractionOfDispLarge*R;
							var dotX = cx[0] + localR * Math.cos(2*Math.PI/numberOfDotsEach.line[i4]*i3);
							var dotY = cy[0] + localR * Math.sin(2*Math.PI/numberOfDotsEach.line[i4]*i3);

							context.beginPath();
							context.fillStyle = "rgba(0,"+255*intensity2+",0,0.6)";

							context.arc(dotX,dotY,flowerCenterDotSize*0.75,2*Math.PI,false);
							context.fill();
							context.closePath();
						}
					}
				}
					// console.log('px' + i3);
					// requestAnimationFrame(centerCircleFillerPattern);
			}

			// small circles inner Bulb animations set
			var intensity = 0.9 ;	
			var dotSize = 0.003*w;
			var dotsForSmallCircle = {
				numberOfDots : [12,24,36],
				radii : [0.7,0.8,0.9]
			};
			var drawInnerCirclePattern = function(){
			
				for (var k = 0; k < dotsForSmallCircle.radii.length; k++) {
					// context.strokeStyle = "rgba(255,255,255,"+intensity+")";
					context.fillStyle = "rgba("+Math.random()*255+","+Math.random()*255+","+Math.random()*255+","+intensity+")";
					for (var j = 1; j < cx.length; j++) {
						for(var i = 0; i<dotsForSmallCircle.numberOfDots[k] ;i++){
							context.beginPath();
							// context.clearRect(cx[j] + r * dotsForSmallCircle.radii[k] * Math.cos(2*Math.PI/dotsForSmallCircle.numberOfDots[k]*i) - dotSize,
							// 	cy[j] + r * dotsForSmallCircle.radii[k] * Math.sin(2*Math.PI/dotsForSmallCircle.numberOfDots[k]*i) - dotSize,
							// 	2*dotSize,
							// 	2*dotSize);

							context.arc(cx[j] + r * dotsForSmallCircle.radii[k] * Math.cos(2*Math.PI/dotsForSmallCircle.numberOfDots[k]*i) ,
								cy[j] + r * dotsForSmallCircle.radii[k] * Math.sin(2*Math.PI/dotsForSmallCircle.numberOfDots[k]*i),
								dotSize,
								Math.PI*2,
								false);
							// context.stroke();
							context.fill();
							context.closePath();	
						}
					}
				}
				// requestAnimationFrame(drawInnerCirclePattern);
			}

			var drawOuterLine = function(){
				var numberOfDotsOuterRing = 8;
				var fr = 0.1;

				// var alpha = Math.atan((Math.sqrt(3)*fr)/(2*Math.sqrt(2) + fr));
				var alpha = 0.625 * Math.PI - Math.acos(1/(1 + fr));
				var k = 0;
				

				for (var j = 3; j <= 7; j++) {
					for (var i = -numberOfDotsOuterRing; i < numberOfDotsOuterRing; i++) {
						context.fillStyle = "rgba("+255*Math.random()+",255,255,0.5)";
						pointX = cx[j] + r*(1+fr) * Math.cos(-k * Math.PI/4 + alpha/numberOfDotsOuterRing*i);
						pointY = cy[j] + r*(1+fr) * Math.sin(-k * Math.PI/4 + alpha/numberOfDotsOuterRing*i);
						
						context.beginPath();
						context.arc(pointX,pointY,dotSize,Math.PI*2,false);
						context.fill();
						context.closePath();						
					}
					k++;
				}

				// right corner
				var beta = Math.acos((1 - fr)/(1 + fr));
				
				var rightStartAngle = Math.PI/4 - alpha;

				var fullAngle = 0.75*Math.PI - (alpha + beta);

				
				var delta = ((-rightStartAngle + beta)/numberOfDotsOuterRing);
				// console.log(delta*180/(Math.PI));

				for(var k = 0; k<=(numberOfDotsOuterRing + 1); k++){

					pointX = cx[2] +  (1 + fr)*r * Math.cos(rightStartAngle + delta * k);
					pointY = cy[2] +  (1 + fr)*r * Math.sin(rightStartAngle + delta * k);
					
					context.fillStyle = "rgba("+255*Math.random()+",255,255,0.5)";
					context.beginPath();
					context.arc(pointX,pointY,dotSize,Math.PI*2,false);
					context.fill();
					context.closePath();

					//mirror for left side
					pointX = 2*cx[0]-pointX;
					context.beginPath();
					context.arc(pointX,pointY,dotSize,Math.PI*2,false);
					context.fill();
					context.closePath();					
				}

				// drow box outline
				var boxUpperStertX = cx[2] +  (1 + fr)*r * Math.sin(beta);
				var boxUpperStertY = cy[2] +  (1 + fr)*r * Math.cos(beta);
				var boxUpperEndX = cx[0] + R + (3)*r ; // box upper end y is same as end 
				// pointX = boxUpperStertX;
				// pointY = boxUpperStertY;
				var boxUpperLastX;

				var boxUpperNumberOfDots = 12;
				var boxUpperDeltaX = (boxUpperEndX - boxUpperStertX)/boxUpperNumberOfDots;
				for(var x = boxUpperStertX ; x<= boxUpperEndX ;x=x+boxUpperDeltaX ){
					context.fillStyle = "rgba("+255*Math.random()+",255,255,0.5)";
					context.beginPath();
					context.arc(x,boxUpperStertY,dotSize,Math.PI*2,false);
					context.fill();
					context.closePath();

					//MIRROR
					// context.fillStyle = "rgba(0,0,255,0.5)";
					context.beginPath();
					context.arc(cx[0]*2 - x,boxUpperStertY,dotSize,Math.PI*2,false);
					context.fill();
					context.closePath();
					boxUpperLastX = x;

				}
				
			}
		
			//draw fill triangle between circles
			var filTriangle = function(){
				// var i=1;
				fr = 0.05;
				var frd = 1+fr;
				var plotAngle;
				for (var i = 1; i < cx.length - 2; i++) {
					for (var i4 = -3; i4 < 3; i4++) {
						// console.log(i4);
						pointX = cx[0] + R*(1 + 0.1*i4)*Math.sin(plotAngle);
						pointY = cy[0] + R*(1 + 0.1*i4)*Math.cos(plotAngle);

						plotAngle = (1 + 2*i)*Math.PI/8;
						context.fillStyle = "rgba(0,"+Math.random()*255+",255,0.8)";
						context.beginPath();
						context.arc(pointX,pointY,dotSize,Math.PI*2,false);
						context.fill();
						context.closePath();
					}				
				}
			}
			// filTriangle();

			var image = new Image();
			image.src = "images/e0499.png";
			image.addEventListener('load',function(){
				for(var i = 1; i < cx.length ; i++){
					context.drawImage(image,(cx[i] - r*fractionOfDispSmall),(cy[i] - r*fractionOfDispSmall),fractionOfDispSmall*2*r,fractionOfDispSmall*2*r);
				}
			});

			var imageCenter = new Image();
			var dim = 2*R*Math.sin(Math.atan(0.5));
			imageCenter.src = "images/e1472.png";
			imageCenter.addEventListener('load',function(){
				context.drawImage(imageCenter,(cx[0] - R*Math.sin(Math.PI/6) + 0.005*w),cy[0],dim,dim);
				
			});

			//start patterns to run:
			// drawInnerCirclePattern();
			var triggerTime = 250;
			setInterval(drawInnerCirclePattern,triggerTime);
			// centerCircleFillerPattern();
			setInterval(centerCircleFillerPattern,triggerTime);
			// centerCircleFlowerPattern();
			setInterval(centerCircleFlowerPattern,triggerTime/2);
			// drawOuterLine()
			setInterval(drawOuterLine,triggerTime);
			//filTriangle()
			setInterval(filTriangle,triggerTime);
		}
	</script>

</body>
</html>